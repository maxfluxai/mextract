<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEXTRACT // NULL_VOID</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=VT323&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #000000;
            --fg-color: #ffffff;
            --dim-color: #333333;
            --glitch-color: #888888;
        }

        body {
            background-color: var(--bg-color);
            color: var(--fg-color);
            font-family: 'Share Tech Mono', monospace;
            overflow-x: hidden;
            cursor: crosshair;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; border-left: 1px solid #333; }
        ::-webkit-scrollbar-thumb { background: #fff; }

        /* CRT Scanline Effect */
        .scanlines {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 999;
            animation: scrollScan 10s linear infinite;
        }
        
        .flicker {
            animation: flicker 0.15s infinite;
            pointer-events: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.02);
            z-index: 998;
        }

        @keyframes scrollScan {
            0% { background-position: 0 0; }
            100% { background-position: 0 100%; }
        }

        @keyframes flicker {
            0% { opacity: 0.9; }
            50% { opacity: 1.0; }
            100% { opacity: 0.95; }
        }

        /* Glitch Text */
        .glitch {
            position: relative;
        }
        .glitch::before, .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: black;
        }
        .glitch::before {
            left: 2px;
            text-shadow: -1px 0 #fff;
            clip: rect(24px, 550px, 90px, 0);
            animation: glitch-anim-2 3s infinite linear alternate-reverse;
        }
        .glitch::after {
            left: -2px;
            text-shadow: -1px 0 #999;
            clip: rect(85px, 550px, 140px, 0);
            animation: glitch-anim 2.5s infinite linear alternate-reverse;
        }

        @keyframes glitch-anim {
            0% { clip: rect(10px, 9999px, 30px, 0); }
            20% { clip: rect(80px, 9999px, 100px, 0); }
            40% { clip: rect(10px, 9999px, 80px, 0); }
            60% { clip: rect(40px, 9999px, 60px, 0); }
            80% { clip: rect(90px, 9999px, 20px, 0); }
            100% { clip: rect(10px, 9999px, 50px, 0); }
        }
        @keyframes glitch-anim-2 {
            0% { clip: rect(60px, 9999px, 80px, 0); }
            20% { clip: rect(10px, 9999px, 30px, 0); }
            40% { clip: rect(90px, 9999px, 100px, 0); }
            60% { clip: rect(20px, 9999px, 40px, 0); }
            80% { clip: rect(50px, 9999px, 70px, 0); }
            100% { clip: rect(30px, 9999px, 90px, 0); }
        }

        /* Cyberpunk Controls */
        .cy-button {
            background: transparent;
            border: 2px solid #fff;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 10px 20px;
            position: relative;
            transition: all 0.1s;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }
        .cy-button:hover:not(:disabled) {
            background: #fff;
            color: #000;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
            cursor: pointer;
        }
        .cy-button:active:not(:disabled) {
            transform: scale(0.98);
        }
        .cy-button:disabled {
            border-color: #333;
            color: #333;
            cursor: not-allowed;
        }

        .cy-input {
            background: #000;
            border: 1px solid #333;
            color: #fff;
            font-family: 'Share Tech Mono', monospace;
            outline: none;
        }
        .cy-input:focus {
            border-color: #fff;
            box-shadow: 0 0 10px rgba(255,255,255,0.2);
        }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 10px;
            background: #fff;
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 0 5px #fff;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #333;
            border: 1px solid #555;
        }

        /* Loading Screen */
        #loader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s;
        }
        .loader-bar {
            width: 300px;
            height: 4px;
            background: #333;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }
        .loader-fill {
            position: absolute;
            top: 0; left: 0;
            height: 100%;
            background: #fff;
            width: 0%;
            animation: loadFill 2s ease-in-out forwards;
        }
        @keyframes loadFill {
            0% { width: 0%; }
            20% { width: 10%; }
            40% { width: 45%; }
            60% { width: 50%; }
            100% { width: 100%; }
        }

        /* Terminal Output */
        .terminal-log {
            font-family: 'VT323', monospace;
            font-size: 1.1rem;
            line-height: 1.2;
        }
    </style>
</head>
<body class="h-screen flex flex-col justify-between selection:bg-white selection:text-black">

    <!-- AUDIO SYSTEM (Invisible) -->
    <div id="audio-root"></div>

    <!-- OVERLAYS -->
    <div class="scanlines"></div>
    <div class="flicker"></div>

    <!-- LOADING SCREEN -->
    <div id="loader">
        <h1 class="text-4xl md:text-6xl font-bold tracking-widest glitch" data-text="MEXTRACT">MEXTRACT</h1>
        <p class="mt-4 text-sm animate-pulse">INITIALIZING CORE PROTOCOLS...</p>
        <div class="loader-bar"><div class="loader-fill"></div></div>
    </div>

    <!-- MAIN APP -->
    <div class="relative z-10 container mx-auto p-4 flex-grow flex flex-col">
        
        <!-- HEADER -->
        <header class="border-b-2 border-white pb-4 mb-8 flex justify-between items-end">
            <div>
                <h1 class="text-4xl font-bold tracking-tighter">MEXTRACT <span class="text-xs align-top ml-2 opacity-50">v.1.0.4</span></h1>
                <p class="text-xs text-gray-400">LOSSLESS FRAME EXTRACTION UNIT</p>
            </div>
            <div class="text-right hidden md:block">
                <p class="text-xs" id="clock">00:00:00</p>
                <p class="text-xs text-green-500">SYS: ONLINE</p>
            </div>
        </header>

        <!-- CONTENT GRID -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 flex-grow">
            
            <!-- LEFT COLUMN: DISPLAY & CONTROLS -->
            <div class="lg:col-span-2 flex flex-col gap-4">
                
                <!-- DROP ZONE / VIDEO PLAYER -->
                <div id="drop-zone" class="border-2 border-dashed border-gray-600 h-64 md:h-96 flex flex-col justify-center items-center transition-all hover:border-white hover:bg-gray-900 relative overflow-hidden group cursor-pointer">
                    <input type="file" id="file-input" accept="video/*" class="absolute inset-0 opacity-0 cursor-pointer z-20">
                    <div class="text-center z-10 pointer-events-none group-hover:scale-110 transition-transform">
                        <div class="text-4xl mb-2">＋</div>
                        <p class="text-sm tracking-widest">INITIATE DATA UPLOAD</p>
                        <p class="text-xs text-gray-500 mt-2">[DRAG VIDEO OR CLICK]</p>
                    </div>
                    
                    <video id="main-video" class="absolute inset-0 w-full h-full object-contain hidden bg-black z-10"></video>
                    <!-- Hidden canvas for processing -->
                    <canvas id="proc-canvas" class="hidden"></canvas>
                </div>

                <!-- PLAYBACK CONTROLS -->
                <div class="border border-gray-800 p-4 bg-black/50 backdrop-blur-sm">
                    
                    <!-- TIMELINE SLIDER -->
                    <div class="mb-4 flex items-center gap-4">
                        <span class="text-xs font-mono w-16" id="current-time">00:00</span>
                        <input type="range" id="seek-slider" min="0" max="100" value="0" disabled>
                        <span class="text-xs font-mono w-16 text-right" id="total-time">00:00</span>
                    </div>

                    <!-- BUTTONS -->
                    <div class="flex flex-wrap justify-center gap-2">
                        <button id="btn-prev" class="cy-button py-1 px-3" title="Prev Frame" disabled>&lt;</button>
                        <button id="btn-play" class="cy-button py-1 px-6" disabled>PLAY</button>
                        <button id="btn-pause" class="cy-button py-1 px-6 hidden">STOP</button>
                        <button id="btn-next" class="cy-button py-1 px-3" title="Next Frame" disabled>&gt;</button>
                    </div>
                </div>

            </div>

            <!-- RIGHT COLUMN: EXTRACTION TERMINAL -->
            <div class="border-l-0 lg:border-l border-gray-800 pl-0 lg:pl-6 flex flex-col gap-4">
                
                <div class="bg-gray-900/30 p-4 border border-gray-700">
                    <h2 class="text-lg font-bold border-b border-gray-600 mb-4 pb-2">EXTRACTION MODULE</h2>
                    
                    <!-- RANGE MARKERS -->
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <div class="bg-black border border-gray-600 p-2">
                            <p class="text-xs text-gray-500">START MARKER</p>
                            <div class="flex justify-between items-center">
                                <span id="start-time-display" class="text-lg">0.00s</span>
                                <button id="btn-set-start" class="text-xs border border-white px-2 py-1 hover:bg-white hover:text-black" disabled>SET</button>
                            </div>
                        </div>
                        <div class="bg-black border border-gray-600 p-2">
                            <p class="text-xs text-gray-500">END MARKER</p>
                            <div class="flex justify-between items-center">
                                <span id="end-time-display" class="text-lg">0.00s</span>
                                <button id="btn-set-end" class="text-xs border border-white px-2 py-1 hover:bg-white hover:text-black" disabled>SET</button>
                            </div>
                        </div>
                    </div>

                    <!-- ACTIONS -->
                    <div class="flex flex-col gap-2">
                        <button id="btn-snap" class="cy-button w-full text-sm" disabled>EXTRACT CURRENT FRAME (1)</button>
                        <button id="btn-range" class="cy-button w-full text-sm" disabled>EXTRACT RANGE [.ZIP]</button>
                        <button id="btn-full" class="cy-button w-full text-sm border-red-500 text-red-100 hover:bg-red-600" disabled>EXTRACT FULL VIDEO</button>
                    </div>
                </div>

                <!-- STATUS LOG -->
                <div class="flex-grow border border-gray-800 bg-black p-2 relative overflow-hidden h-48 lg:h-auto">
                    <div class="absolute top-0 left-0 bg-white text-black text-xs px-2">SYS_LOG</div>
                    <div id="console-output" class="terminal-log mt-6 h-full overflow-y-auto text-gray-400 pb-8">
                        <p>> SYSTEM INITIALIZED...</p>
                        <p>> WAITING FOR MEDIA INPUT...</p>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <!-- FOOTER -->
    <footer class="relative z-10 border-t border-gray-800 p-4 bg-black text-center md:text-left flex flex-col md:flex-row justify-between items-center">
        <div class="text-xs text-gray-500 mb-2 md:mb-0">
            MEXTRACT © 2077 // MAXFLUX AI CORP
        </div>
        <div class="flex gap-6 text-sm font-bold tracking-wider">
            <a href="https://x.com/maxfluxai" target="_blank" class="hover:text-gray-400 hover:underline decoration-dotted transition-colors">X.COM/MAXFLUXAI</a>
            <a href="https://instagram.com/maxfluxai" target="_blank" class="hover:text-gray-400 hover:underline decoration-dotted transition-colors">INSTAGRAM.COM/MAXFLUXAI</a>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- AUDIO SYSTEM ---
        class SoundFX {
            constructor() {
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                this.masterGain = this.ctx.createGain();
                this.masterGain.gain.value = 0.3;
                this.masterGain.connect(this.ctx.destination);
            }

            playTone(freq, type, duration) {
                if (this.ctx.state === 'suspended') this.ctx.resume();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                gain.gain.setValueAtTime(0.3, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
                osc.connect(gain);
                gain.connect(this.masterGain);
                osc.start();
                osc.stop(this.ctx.currentTime + duration);
            }

            hover() { this.playTone(800, 'sine', 0.05); }
            click() { this.playTone(220, 'square', 0.1); this.playTone(150, 'sawtooth', 0.1); }
            error() { this.playTone(100, 'sawtooth', 0.3); this.playTone(80, 'square', 0.3); }
            process() { 
                // Random glitch sound
                this.playTone(1000 + Math.random()*2000, 'sawtooth', 0.05); 
            }
            boot() {
                const now = this.ctx.currentTime;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.frequency.setValueAtTime(100, now);
                osc.frequency.exponentialRampToValueAtTime(2000, now + 2);
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.5, now + 1);
                gain.gain.linearRampToValueAtTime(0, now + 2);
                osc.connect(gain);
                gain.connect(this.masterGain);
                osc.start();
                osc.stop(now + 2);
            }
        }

        const sfx = new SoundFX();

        // --- UTILITIES ---
        const $ = (id) => document.getElementById(id);
        const log = (msg, type="info") => {
            const consoleDiv = $('console-output');
            const p = document.createElement('p');
            p.textContent = `> ${msg.toUpperCase()}`;
            if(type === 'error') p.style.color = '#ff5555';
            if(type === 'success') p.style.color = '#55ff55';
            consoleDiv.appendChild(p);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };

        // --- STATE ---
        let videoFile = null;
        let startMarker = 0;
        let endMarker = 0;
        const FRAME_STEP = 0.04; // Approx 25fps step for manual seeking
        let isProcessing = false;

        // --- ELEMENTS ---
        const loader = $('loader');
        const video = $('main-video');
        const fileInput = $('file-input');
        const canvas = $('proc-canvas');
        const ctx = canvas.getContext('2d');
        
        // Controls
        const btnPlay = $('btn-play');
        const btnPause = $('btn-pause');
        const btnPrev = $('btn-prev');
        const btnNext = $('btn-next');
        const slider = $('seek-slider');
        
        // Markers
        const btnSetStart = $('btn-set-start');
        const btnSetEnd = $('btn-set-end');
        const displayStart = $('start-time-display');
        const displayEnd = $('end-time-display');

        // Extract
        const btnSnap = $('btn-snap');
        const btnRange = $('btn-range');
        const btnFull = $('btn-full');

        // --- INITIALIZATION ---
        window.addEventListener('load', () => {
            sfx.boot();
            setTimeout(() => {
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 500);
                log("System Ready.");
            }, 2000);

            // Clock Update
            setInterval(() => {
                const now = new Date();
                $('clock').textContent = now.toLocaleTimeString('en-GB');
            }, 1000);
        });

        // --- EVENT LISTENERS ---

        // Button FX
        document.querySelectorAll('button').forEach(b => {
            b.addEventListener('mouseenter', () => !b.disabled && sfx.hover());
            b.addEventListener('click', () => !b.disabled && sfx.click());
        });

        // File Upload
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            const url = URL.createObjectURL(file);
            video.src = url;
            videoFile = file;
            
            $('drop-zone').querySelector('.text-center').style.display = 'none';
            video.classList.remove('hidden');
            
            log(`Loaded: ${file.name}`, "success");
            
            video.onloadedmetadata = () => {
                slider.max = video.duration;
                endMarker = video.duration;
                updateTimeDisplay();
                updateMarkersUI();
                enableControls();
                log(`Duration: ${video.duration.toFixed(2)}s`);
                log(`Resolution: ${video.videoWidth}x${video.videoHeight}`);
            };
        });

        // Video Controls
        btnPlay.addEventListener('click', () => { video.play(); togglePlayBtn(true); });
        btnPause.addEventListener('click', () => { video.pause(); togglePlayBtn(false); });
        
        video.addEventListener('timeupdate', () => {
            slider.value = video.currentTime;
            updateTimeDisplay();
        });
        
        video.addEventListener('ended', () => togglePlayBtn(false));

        slider.addEventListener('input', () => {
            video.currentTime = slider.value;
            updateTimeDisplay();
        });

        // Frame stepping
        btnPrev.addEventListener('click', () => {
            video.pause(); togglePlayBtn(false);
            video.currentTime = Math.max(0, video.currentTime - FRAME_STEP);
        });

        btnNext.addEventListener('click', () => {
            video.pause(); togglePlayBtn(false);
            video.currentTime = Math.min(video.duration, video.currentTime + FRAME_STEP);
        });

        // Markers
        btnSetStart.addEventListener('click', () => {
            startMarker = video.currentTime;
            if(startMarker > endMarker) endMarker = video.duration;
            updateMarkersUI();
            log(`Start point set: ${startMarker.toFixed(2)}s`);
        });

        btnSetEnd.addEventListener('click', () => {
            endMarker = video.currentTime;
            if(endMarker < startMarker) startMarker = 0;
            updateMarkersUI();
            log(`End point set: ${endMarker.toFixed(2)}s`);
        });

        // --- EXTRACTION LOGIC ---

        // 1. Single Frame
        btnSnap.addEventListener('click', () => {
            drawFrame();
            canvas.toBlob((blob) => {
                saveAs(blob, `frame_${video.currentTime.toFixed(2)}.jpg`);
                log("Single frame extracted.", "success");
            }, 'image/jpeg', 1.0);
        });

        // 2. Range Extraction
        btnRange.addEventListener('click', () => {
            startExtraction(startMarker, endMarker);
        });

        // 3. Full Extraction
        btnFull.addEventListener('click', () => {
            startExtraction(0, video.duration);
        });


        // Helper Functions
        function togglePlayBtn(isPlaying) {
            if(isPlaying) {
                btnPlay.classList.add('hidden');
                btnPause.classList.remove('hidden');
            } else {
                btnPlay.classList.remove('hidden');
                btnPause.classList.add('hidden');
            }
        }

        function updateTimeDisplay() {
            $('current-time').textContent = formatTime(video.currentTime);
            $('total-time').textContent = formatTime(video.duration);
        }

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = Math.floor(seconds % 60);
            const ms = Math.floor((seconds % 1) * 100);
            return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        function updateMarkersUI() {
            displayStart.textContent = startMarker.toFixed(2) + 's';
            displayEnd.textContent = endMarker.toFixed(2) + 's';
        }

        function enableControls() {
            [btnPlay, btnPrev, btnNext, slider, btnSetStart, btnSetEnd, btnSnap, btnRange, btnFull].forEach(el => {
                el.disabled = false;
            });
        }

        function drawFrame() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        }

        // --- CORE EXTRACTION ENGINE ---
        async function startExtraction(start, end) {
            if(isProcessing) return;
            isProcessing = true;
            disableInterface();
            
            log(`INITIATING BATCH PROCESS...`, "info");
            log(`RANGE: ${start.toFixed(2)}s - ${end.toFixed(2)}s`);

            const zip = new JSZip();
            const folder = zip.folder("mextract_frames");
            
            let currentTime = start;
            let frameCount = 1;
            const totalDuration = end - start;
            
            video.pause();
            togglePlayBtn(false);

            // Seek Loop
            while (currentTime <= end) {
                // Update UI less frequently to save resources
                if(frameCount % 5 === 0) {
                    log(`PROCESSING FRAME ${frameCount}...`);
                    sfx.process(); // Play glitch sound
                    $('console-output').scrollTop = $('console-output').scrollHeight;
                }

                // Seek
                video.currentTime = currentTime;
                
                // Wait for seek
                await new Promise(resolve => {
                    const onSeek = () => {
                        video.removeEventListener('seeked', onSeek);
                        resolve();
                    };
                    video.addEventListener('seeked', onSeek);
                });

                // Draw
                drawFrame();
                
                // Convert to Blob Promise
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 1.0));
                const filename = `${frameCount}.jpg`;
                
                folder.file(filename, blob);

                // Increment
                currentTime += 0.04; // ~25fps capture rate. Increase 0.04 to 0.1 for fewer frames.
                frameCount++;

                // Safety break for huge videos to prevent browser crash (limit 1000 frames for safety in this demo)
                if(frameCount > 3000) {
                    log("SAFETY LIMIT REACHED (3000 FRAMES). STOPPING.", "error");
                    break;
                }
                
                // Small delay to let UI breathe
                await new Promise(r => setTimeout(r, 10));
            }

            log("COMPRESSING DATA...", "info");
            
            zip.generateAsync({type:"blob"}).then(function(content) {
                saveAs(content, "mextract_batch.zip");
                log("DOWNLOAD INITIATED.", "success");
                sfx.boot(); // Success sound
                isProcessing = false;
                enableControls();
            });
        }

        function disableInterface() {
            [btnPlay, btnPrev, btnNext, slider, btnSetStart, btnSetEnd, btnSnap, btnRange, btnFull, fileInput].forEach(el => {
                el.disabled = true;
            });
        }

    </script>
</body>
</html>