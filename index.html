<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MEXTRACT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

    <style>
        /* 
        ================================================================
        // CORE CONFIGURATION
        ================================================================
        */
        :root {
            --bg-core: #000000;
            --panel-bg: rgba(10, 10, 10, 0.85);
            --fg-primary: #ffffff;
            --fg-dim: #666666;
            --accent: #ffffff;
            --border: 1px solid #333;
            --font-head: 'Orbitron', sans-serif;
            --font-ui: 'Rajdhani', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-core);
            color: var(--fg-primary);
            font-family: var(--font-ui);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- RAIN BACKGROUND (GLOBAL) --- */
        #rain-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* --- SCANLINES --- */
        .scanline-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 0, 0, 0.2) 3px
            );
            z-index: 1;
            pointer-events: none;
        }

        /* --- LOADING SCREEN (1.5s) --- */
        #loader {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease, visibility 0.5s;
        }
        
        .loader-bar-wrap {
            width: 200px;
            height: 2px;
            background: #333;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }
        .loader-bar {
            width: 0%;
            height: 100%;
            background: #fff;
            position: absolute;
            top: 0; left: 0;
            /* CHANGED: Duration 1.5s */
            animation: loadAnim 1.5s linear forwards;
        }
        .loader-text {
            font-family: var(--font-head);
            letter-spacing: 4px;
            animation: pulse 0.2s infinite; /* Faster pulse for hype */
        }

        /* --- MAIN APP LAYOUT --- */
        #app-interface {
            position: relative;
            z-index: 10;
            height: 100%;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transition: opacity 1s ease;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
        }
        #app-interface.active { opacity: 1; }

        /* HEADER */
        header {
            height: 70px;
            border-bottom: var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            background: var(--panel-bg);
            backdrop-filter: blur(5px);
        }
        
        #logo-container {
            width: 250px; /* Slightly wider for animation space */
            height: 60px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        /* WORKSPACE (Split View) */
        .workspace {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* LEFT: VIDEO AREA */
        .panel-video {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: var(--border);
            position: relative;
            background: rgba(0,0,0,0.3);
        }

        /* RIGHT: CONTROLS */
        .panel-controls {
            width: 360px;
            background: var(--panel-bg);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 25px;
            overflow-y: auto;
        }

        /* UPLOAD COMPONENT */
        .upload-zone {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px dashed #333;
            margin: 20px;
            transition: 0.3s;
            cursor: pointer;
        }
        .upload-zone:hover {
            border-color: #fff;
            background: rgba(255,255,255,0.05);
        }
        .upload-icon { font-size: 4rem; font-weight: 100; margin-bottom: 10px; }

        /* VIDEO PLAYER */
        .video-wrapper {
            display: none;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
            background: #000;
            position: relative;
        }
        video {
            max-width: 100%;
            max-height: 100%;
            display: block;
        }

        /* CONTROL WIDGETS */
        .widget { display: flex; flex-direction: column; gap: 8px; }
        .widget-label {
            font-family: var(--font-head);
            font-size: 0.7rem;
            color: var(--fg-dim);
            letter-spacing: 1px;
        }

        /* SCRUBBER */
        .scrub-track {
            width: 100%; height: 30px;
            background: #111;
            border: 1px solid #333;
            position: relative;
            cursor: crosshair;
        }
        .scrub-fill {
            position: absolute; top: 0; left: 0; height: 100%; width: 0%;
            background: #fff; pointer-events: none;
        }
        .scrub-thumb {
            position: absolute; top: 0; left: 0; width: 2px; height: 100%;
            background: #fff; box-shadow: 0 0 10px #fff;
            pointer-events: none; transform: translateX(-50%);
        }
        input[type=range] {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0; cursor: pointer;
        }

        /* BUTTONS */
        .btn-group { display: flex; gap: 10px; }
        .cyber-btn {
            flex: 1;
            background: transparent;
            border: 1px solid #444;
            color: #fff;
            padding: 12px;
            font-family: var(--font-ui);
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: 0.2s;
        }
        .cyber-btn:hover { background: #fff; color: #000; }
        
        .btn-primary { border-color: #fff; background: rgba(255,255,255,0.05); }
        .btn-primary:hover { box-shadow: 0 0 15px rgba(255,255,255,0.5); }

        /* FOOTER */
        footer {
            height: 50px;
            border-top: var(--border);
            background: var(--panel-bg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 0.8rem;
            color: var(--fg-dim);
        }
        .socials { display: flex; gap: 20px; }
        .social-link {
            color: var(--fg-dim); text-decoration: none;
            display: flex; align-items: center; gap: 8px; transition: 0.3s;
        }
        .social-link:hover { color: #fff; }
        .icon { width: 16px; height: 16px; fill: currentColor; }

        /* RESPONSIVE LAYOUT */
        @media (max-width: 900px) {
            .workspace { flex-direction: column; }
            .panel-video { height: 50vh; border-right: none; border-bottom: var(--border); }
            .panel-controls { width: 100%; height: 50vh; padding: 15px; }
            .upload-icon { font-size: 2.5rem; }
            .cyber-btn { padding: 14px; font-size: 0.9rem; }
        }

        /* ANIMATIONS */
        @keyframes loadAnim { 0% { width: 0%; } 100% { width: 100%; } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <!-- RAIN LAYER -->
    <canvas id="rain-canvas"></canvas>
    <div class="scanline-overlay"></div>

    <!-- LOADING SCREEN -->
    <div id="loader">
        <div class="loader-text">MEXTRACT</div>
        <div class="loader-bar-wrap"><div class="loader-bar"></div></div>
        <div style="margin-top: 10px; font-family: var(--font-code); font-size: 0.7rem; color: #666;">
            INITIALIZING CORE...
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app-interface">
        
        <header>
            <div id="logo-container">
                <canvas id="logo-canvas"></canvas>
            </div>
            <div style="font-family: var(--font-code); font-size: 0.8rem; opacity: 0.7;" id="clock">
                00:00:00
            </div>
        </header>

        <div class="workspace">
            
            <!-- LEFT PANEL -->
            <div class="panel-video">
                <label class="upload-zone" id="upload-trigger">
                    <div class="upload-icon">+</div>
                    <div style="letter-spacing: 2px;">UPLOAD VIDEO</div>
                    <div style="font-family: var(--font-code); font-size: 0.7rem; opacity: 0.5; margin-top: 5px;">MP4 . MOV . WEBM</div>
                    <input type="file" id="file-input" accept="video/*" hidden>
                </label>

                <div class="video-wrapper" id="video-wrapper">
                    <video id="main-video" playsinline muted></video>
                </div>
            </div>

            <!-- RIGHT PANEL -->
            <div class="panel-controls">
                
                <div class="widget">
                    <div class="widget-label">TIMELINE</div>
                    <div class="scrub-track">
                        <div class="scrub-fill" id="scrub-fill"></div>
                        <div class="scrub-thumb" id="scrub-head"></div>
                        <input type="range" id="seek-bar" min="0" value="0" step="0.001">
                    </div>
                    <div style="display:flex; justify-content:space-between; font-family: var(--font-code); font-size: 0.7rem;">
                        <span id="t-curr">00.00s</span>
                        <span id="t-dur">00.00s</span>
                    </div>
                </div>

                <div class="widget">
                    <div class="widget-label">NAVIGATION</div>
                    <div class="btn-group">
                        <button class="cyber-btn" id="btn-back">&lt; FRAME</button>
                        <button class="cyber-btn" id="btn-play">PLAY</button>
                        <button class="cyber-btn" id="btn-fwd">FRAME &gt;</button>
                    </div>
                </div>

                <div style="flex: 1;"></div>

                <div class="widget">
                    <div class="widget-label">EXTRACTION PROTOCOLS</div>
                    <button class="cyber-btn btn-primary" id="btn-png">
                        EXTRACT PNG (LOSSLESS)
                    </button>
                    <button class="cyber-btn btn-primary" id="btn-jpg" style="margin-top: 10px; border-color: #666; opacity: 0.8;">
                        EXTRACT JPG (COMPRESSED)
                    </button>
                </div>

            </div>
        </div>

        <footer>
            <div>POWERED BY MAXFLUX AI</div>
            <div class="socials">
                <a href="https://www.instagram.com/maxfluxai" target="_blank" class="social-link">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                    @maxfluxai
                </a>
                <a href="https://www.x.com/maxfluxai" target="_blank" class="social-link">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                    @maxfluxai
                </a>
            </div>
        </footer>

    </div>

    <!-- OFFSCREEN CANVAS -->
    <canvas id="proc-canvas" class="hidden"></canvas>

    <script>
        /* 
        ================================================================
        // SYSTEM KERNEL
        ================================================================
        */

        // --- AUDIO SYSTEM ---
        const AudioSys = {
            ctx: null,
            ready: false,
            init: function() {
                if(this.ready) return;
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
                this.ready = true;
            },
            tone: function(freq, type, dur) {
                if(!this.ready) { this.init(); return; }
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + dur);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + dur);
            },
            click: function() { this.tone(1000, 'sine', 0.1); },
            success: function() { this.tone(600, 'square', 0.1); setTimeout(()=>this.tone(1200,'sine',0.2), 100); }
        };

        // --- RAIN SYSTEM ---
        const RainSys = {
            canvas: document.getElementById('rain-canvas'),
            init: function() {
                const ctx = this.canvas.getContext('2d');
                let w, h;
                const drops = [];
                
                const resize = () => {
                    w = this.canvas.width = window.innerWidth;
                    h = this.canvas.height = window.innerHeight;
                    drops.length = 0;
                    for(let i=0; i<120; i++) drops.push({
                        x: Math.random()*w, y: Math.random()*h,
                        l: Math.random()*15+5, s: Math.random()*10+5
                    });
                };
                window.addEventListener('resize', resize);
                resize();

                function loop() {
                    ctx.clearRect(0,0,w,h);
                    ctx.fillStyle = 'rgba(255,255,255,0.15)'; // Subtle rain
                    drops.forEach(d => {
                        d.y += d.s;
                        if(d.y > h) { d.y = -20; d.x = Math.random()*w; }
                        ctx.fillRect(d.x, d.y, 1, d.l);
                    });
                    requestAnimationFrame(loop);
                }
                loop();
            }
        };

        // --- HYPER-STYLIZED LOGO SYSTEM ---
        const LogoSys = {
            c: document.getElementById('logo-canvas'),
            ctx: null,
            w: 0, h: 0,
            particles: [],
            targetText: "MEXTRACT",
            state: "IDLE", // IDLE or MORPH
            
            init: function() {
                this.ctx = this.c.getContext('2d');
                this.resize();
                
                // Events for Interaction
                this.c.addEventListener('mouseenter', () => { 
                    this.morphTo("MAXFLUX"); 
                    AudioSys.click(); 
                });
                this.c.addEventListener('mouseleave', () => { 
                    this.morphTo("MEXTRACT"); 
                });
                
                window.addEventListener('resize', () => this.resize());
                this.animate();
            },
            
            resize: function() {
                this.w = this.c.width = this.c.parentElement.offsetWidth;
                this.h = this.c.height = this.c.parentElement.offsetHeight;
                this.morphTo(this.targetText, true); // Reset
            },

            // Scan text to get particle coordinates
            scan: function(text) {
                const tmp = document.createElement('canvas');
                tmp.width = this.w; tmp.height = this.h;
                const tctx = tmp.getContext('2d');
                tctx.font = '900 28px "Orbitron"';
                tctx.fillStyle = '#fff';
                tctx.textAlign = 'left';
                tctx.textBaseline = 'middle';
                tctx.fillText(text, 10, this.h/2);
                
                const data = tctx.getImageData(0,0,this.w,this.h).data;
                const points = [];
                // Scan density
                for(let y=0; y<this.h; y+=3) {
                    for(let x=0; x<this.w; x+=3) {
                        if(data[(y*this.w+x)*4+3] > 128) points.push({x,y});
                    }
                }
                return points;
            },

            morphTo: function(text, force=false) {
                this.targetText = text;
                const targets = this.scan(text);
                
                // Manage particle pool
                if(this.particles.length < targets.length) {
                    const diff = targets.length - this.particles.length;
                    for(let i=0; i<diff; i++) this.particles.push({
                        x: Math.random()*this.w, y: Math.random()*this.h,
                        tx: 0, ty: 0, vx: 0, vy: 0,
                        color: '#fff' // Base color
                    });
                }
                
                // Assign targets
                this.particles.forEach((p, i) => {
                    if(targets[i]) {
                        p.tx = targets[i].x;
                        p.ty = targets[i].y;
                        p.active = true;
                        // Glitch effect on trigger
                        if(!force) {
                            p.vx = (Math.random()-0.5) * 40; // EXPLODE
                            p.vy = (Math.random()-0.5) * 40;
                            p.color = Math.random() > 0.8 ? '#0ff' : (Math.random() > 0.5 ? '#f0f' : '#fff'); // Cyber colors
                        }
                    } else {
                        p.active = false;
                    }
                });
            },

            animate: function() {
                this.ctx.clearRect(0,0,this.w,this.h);
                
                this.particles.forEach(p => {
                    if(!p.active) return;
                    
                    const dx = p.tx - p.x;
                    const dy = p.ty - p.y;
                    
                    // Spring Physics
                    p.vx += dx * 0.08;
                    p.vy += dy * 0.08;
                    p.vx *= 0.80; // Dampening
                    p.vy *= 0.80;
                    
                    p.x += p.vx;
                    p.y += p.vy;

                    // Draw Glitch Rectangles
                    this.ctx.fillStyle = p.color;
                    
                    // Random flicker
                    if(Math.abs(p.vx) > 1 && Math.random() > 0.8) {
                         this.ctx.fillStyle = Math.random() > 0.5 ? '#0ff' : '#f0f';
                         this.ctx.fillRect(p.x - 5, p.y, 10, 2); // Glitch line
                    } else {
                        this.ctx.fillRect(p.x, p.y, 2, 2); // Standard pixel
                    }
                    
                    // Return to white when settled
                    if(Math.abs(p.vx) < 0.5 && Math.abs(p.vy) < 0.5) p.color = '#fff';
                });
                
                requestAnimationFrame(() => this.animate());
            }
        };

        // --- APP LOGIC ---
        window.addEventListener('load', () => {
            // 1. Start Systems
            RainSys.init();
            LogoSys.init();
            
            // 2. Auto Boot (1.5 Seconds)
            const loader = document.getElementById('loader');
            const app = document.getElementById('app-interface');
            
            setTimeout(() => {
                loader.style.opacity = '0';
                loader.style.visibility = 'hidden';
                app.classList.add('active');
                AudioSys.init(); // Try to init audio if allowed by browser policy on load
            }, 1500);

            // 3. Clock
            setInterval(() => {
                document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-GB');
            }, 1000);

            // 4. Interaction Listener (For Audio Policy)
            document.addEventListener('click', () => AudioSys.init(), {once:true});

            // 5. Video Logic
            const uploadTrig = document.getElementById('upload-trigger');
            const fileIn = document.getElementById('file-input');
            const videoWrap = document.getElementById('video-wrapper');
            const vid = document.getElementById('main-video');
            const seekBar = document.getElementById('seek-bar');
            const btnPlay = document.getElementById('btn-play');
            
            uploadTrig.addEventListener('click', () => fileIn.click());
            fileIn.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if(!file) return;
                const url = URL.createObjectURL(file);
                vid.src = url;
                vid.onloadedmetadata = () => {
                    uploadTrig.style.display = 'none';
                    videoWrap.style.display = 'flex';
                    seekBar.max = vid.duration;
                    document.getElementById('t-dur').innerText = vid.duration.toFixed(2) + "s";
                    AudioSys.success();
                };
            });

            // Seeking
            seekBar.addEventListener('input', (e) => { vid.currentTime = e.target.value; updateUI(); });
            seekBar.addEventListener('mousedown', () => vid.pause());
            
            vid.addEventListener('timeupdate', updateUI);
            
            function updateUI() {
                const p = (vid.currentTime / vid.duration) * 100;
                document.getElementById('scrub-fill').style.width = p + '%';
                document.getElementById('scrub-head').style.left = p + '%';
                document.getElementById('t-curr').innerText = vid.currentTime.toFixed(2) + "s";
                if(document.activeElement !== seekBar) seekBar.value = vid.currentTime;
            }

            // Play Control
            btnPlay.addEventListener('click', () => {
                if(vid.paused) { vid.play(); btnPlay.innerText = "PAUSE"; }
                else { vid.pause(); btnPlay.innerText = "PLAY"; }
                AudioSys.click();
            });

            // Frames
            const F = 0.04;
            document.getElementById('btn-back').addEventListener('click', () => { vid.currentTime -= F; vid.pause(); AudioSys.click(); });
            document.getElementById('btn-fwd').addEventListener('click', () => { vid.currentTime += F; vid.pause(); AudioSys.click(); });

            // Extraction
            function extract(type) {
                if(vid.readyState < 2) return;
                const cvs = document.getElementById('proc-canvas');
                cvs.width = vid.videoWidth; cvs.height = vid.videoHeight;
                const ctx = cvs.getContext('2d');
                ctx.drawImage(vid, 0, 0, cvs.width, cvs.height);
                
                try {
                    const fmt = type === 'png' ? 'image/png' : 'image/jpeg';
                    const ext = type === 'png' ? '.png' : '.jpg';
                    const q = type === 'png' ? 1.0 : 0.85;
                    const data = cvs.toDataURL(fmt, q);
                    const a = document.createElement('a');
                    a.href = data;
                    a.download = `MEXTRACT_${Date.now()}${ext}`;
                    a.click();
                    AudioSys.success();
                } catch(e) {
                    alert("Error: Security Restriction (CORS).");
                }
            }

            document.getElementById('btn-png').addEventListener('click', () => extract('png'));
            document.getElementById('btn-jpg').addEventListener('click', () => extract('jpg'));
        });
    </script>
</body>
</html>