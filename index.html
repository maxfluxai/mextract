<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEXTRACT | SYSTEM CORE X</title>
    <style>
        /* 
        ==========================================================================
        // 0. CORE KERNEL STYLES
        ==========================================================================
        */
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100;400;800&family=Syncopate:wght@700&display=swap');

        :root {
            --c-void: #030303;
            --c-pri: #ffffff;
            --c-sec: #888888;
            --c-dim: #222222;
            --c-acc: #ffffff;
            --f-mono: 'JetBrains Mono', monospace;
            --f-head: 'Syncopate', sans-serif;
            --z-back: -1;
            --z-ui: 10;
            --z-win: 20;
            --z-top: 1000;
            --crt-flicker: 0.02s;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            cursor: none !important; /* SYSTEM CURSOR DISABLED */
            scrollbar-width: none;
        }

        body {
            background-color: var(--c-void);
            color: var(--c-pri);
            font-family: var(--f-mono);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: relative;
        }

        /* --- CUSTOM CURSOR ENGINE --- */
        #cursor-layer {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: var(--z-top);
            mix-blend-mode: difference;
        }
        .cursor-main {
            position: absolute;
            width: 20px; height: 20px;
            border: 1px solid var(--c-pri);
            transform: translate(-50%, -50%);
            transition: width 0.1s, height 0.1s;
        }
        .cursor-dot {
            position: absolute;
            width: 4px; height: 4px;
            background: var(--c-pri);
            transform: translate(-50%, -50%);
        }
        .cursor-x-line, .cursor-y-line {
            position: absolute;
            background: rgba(255,255,255,0.1);
        }
        .cursor-x-line { width: 100vw; height: 1px; top: 50%; left: -50vw; }
        .cursor-y-line { width: 1px; height: 100vh; top: -50vh; left: 50%; }
        
        /* Interaction States */
        body.state-hover .cursor-main {
            width: 40px; height: 40px;
            border-style: dashed;
            animation: spin 4s linear infinite;
            background: rgba(255,255,255,0.05);
        }
        body.state-active .cursor-main {
            width: 10px; height: 10px;
            background: var(--c-pri);
        }

        /* --- CANVAS LAYERS --- */
        .canvas-stack {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
        }
        #rain-canvas { z-index: 0; opacity: 0.15; }
        #ui-fx-canvas { z-index: 1; pointer-events: none; }

        /* --- CRT & POST PROCESSING --- */
        .post-process {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 900;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
        }

        /* --- WINDOW MANAGER SYSTEM --- */
        .os-window {
            position: absolute;
            background: rgba(5, 5, 5, 0.9);
            border: 1px solid var(--c-dim);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 50px rgba(0,0,0,0.8);
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.4s, transform 0.4s, border-color 0.2s;
            z-index: var(--z-win);
        }
        .os-window.active {
            border-color: var(--c-pri);
            z-index: var(--z-win) + 1;
            box-shadow: 0 0 20px rgba(255,255,255,0.05);
        }
        .win-header {
            height: 30px;
            background: var(--c-dim);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            cursor: none; /* Logic handled by JS drag */
            border-bottom: 1px solid var(--c-dim);
        }
        .win-title {
            font-size: 0.7rem;
            letter-spacing: 1px;
            color: var(--c-sec);
        }
        .win-controls {
            display: flex;
            gap: 5px;
        }
        .win-btn {
            width: 10px; height: 10px;
            border: 1px solid var(--c-sec);
            background: transparent;
        }
        .win-content {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* --- COMPONENT: LOGO --- */
        #logo-container {
            width: 400px; height: 100px;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }

        /* --- COMPONENT: UPLOAD --- */
        .upload-grid {
            width: 100%; height: 100%;
            border: 1px dashed var(--c-sec);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            transition: 0.3s;
        }
        .upload-grid:hover {
            background: rgba(255,255,255,0.05);
            border-color: var(--c-pri);
        }

        /* --- COMPONENT: VIDEO PLAYER --- */
        .video-stage {
            width: 100%;
            flex: 1;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--c-dim);
        }
        video {
            max-width: 100%; max-height: 100%;
        }
        
        /* --- COMPONENT: CONTROLS --- */
        .control-rack {
            height: auto;
            margin-top: 10px;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
        }
        .scrubber {
            grid-column: 1 / -1;
            height: 20px;
            background: var(--c-dim);
            position: relative;
            overflow: hidden;
        }
        .scrub-bar {
            height: 100%; background: var(--c-pri); width: 0%;
            position: relative;
            z-index: 1;
        }
        .scrub-ghost {
            position: absolute; top: 0; left: 0; height: 100%; width: 100%;
            background: repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0,0,0,0.5) 3px);
            z-index: 2;
            pointer-events: none;
        }
        input[type="range"] {
            position: absolute; top:0; left:0; width:100%; height:100%; opacity:0; z-index: 3;
        }

        .btn {
            border: 1px solid var(--c-sec);
            background: transparent;
            color: var(--c-pri);
            font-family: var(--f-mono);
            padding: 10px 20px;
            font-size: 0.8rem;
            text-transform: uppercase;
            transition: 0.2s;
            position: relative;
            overflow: hidden;
        }
        .btn:hover {
            background: var(--c-pri);
            color: var(--c-void);
            box-shadow: 0 0 15px rgba(255,255,255,0.5);
        }
        .btn-main {
            border-color: var(--c-pri);
            font-weight: 800;
        }

        /* --- COMPONENT: TERMINAL --- */
        .term-lines {
            font-size: 0.7rem;
            color: var(--c-sec);
            line-height: 1.4;
            height: 100%;
            overflow-y: auto;
        }
        .log-entry { animation: fadeIn 0.2s; }
        .log-succ { color: var(--c-pri); }
        .log-warn { color: #ff0000; }

        /* --- LOADING SCREEN --- */
        #boot-sequence {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        .boot-text {
            font-size: 2rem;
            font-family: var(--f-head);
            margin-bottom: 20px;
            animation: glitch 1s infinite;
        }
        .boot-bar {
            width: 300px; height: 2px; background: #333;
            position: relative;
        }
        .boot-prog {
            position: absolute; top:0; left:0; height: 100%; width: 0%; background: #fff;
        }

        /* ANIMATIONS */
        @keyframes spin { 0% { transform: translate(-50%,-50%) rotate(0deg); } 100% { transform: translate(-50%,-50%) rotate(360deg); } }
        @keyframes glitch { 0% { opacity: 1; transform: translate(0); } 20% { opacity: 0.8; transform: translate(-2px, 2px); } 40% { opacity: 1; transform: translate(2px, -2px); } 100% { opacity: 1; } }
        @keyframes fadeIn { from {opacity:0; transform:translateY(5px);} to {opacity:1; transform:translateY(0);} }

        .visible { opacity: 1 !important; transform: scale(1) !important; }
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <!-- --- LAYERS --- -->
    <div id="boot-sequence">
        <div class="boot-text">SYSTEM CORE X</div>
        <div class="boot-bar"><div class="boot-prog" id="boot-prog"></div></div>
        <div style="margin-top: 10px; font-size: 0.7rem; color: #666;">INITIALIZING NEURAL BRIDGE...</div>
    </div>

    <div class="post-process"></div>
    <canvas id="rain-canvas" class="canvas-stack"></canvas>
    <canvas id="ui-fx-canvas" class="canvas-stack"></canvas>

    <div id="cursor-layer">
        <div class="cursor-x-line"></div>
        <div class="cursor-y-line"></div>
        <div class="cursor-main"></div>
        <div class="cursor-dot"></div>
    </div>

    <!-- --- UI WINDOWS --- -->
    
    <!-- WINDOW 1: MAIN INTERFACE -->
    <div class="os-window" id="win-main" style="width: 800px; height: 600px; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95);">
        <div class="win-header" id="drag-main">
            <span class="win-title">MExtract_GUI // v.10.0</span>
            <div class="win-controls"><div class="win-btn"></div><div class="win-btn"></div></div>
        </div>
        <div class="win-content">
            
            <!-- LOGO MORPH ZONE -->
            <div id="logo-container">
                <canvas id="logo-canvas" width="400" height="100"></canvas>
            </div>

            <!-- STACK MANAGER -->
            <div id="stack-upload" class="upload-grid interactable" data-label="UPLOAD SOURCE">
                <div style="font-size: 3rem;">+</div>
                <div style="margin-top: 10px;">MOUNT VIDEO FILE</div>
                <input type="file" id="file-input" accept="video/*" hidden>
            </div>

            <div id="stack-editor" class="hidden" style="width: 100%; height: 100%; display: flex; flex-direction: column;">
                <div class="video-stage">
                    <video id="main-video" playsinline muted></video>
                </div>
                <div class="control-rack">
                    <div class="scrubber interactable" data-label="SEEK TIME">
                        <div class="scrub-bar" id="scrub-bar"></div>
                        <div class="scrub-ghost"></div>
                        <input type="range" id="seek-input" min="0" value="0" step="0.001">
                    </div>
                    
                    <div style="display:flex; gap: 10px; align-items: center;">
                        <button class="btn interactable" id="btn-prev" data-label="FRAME -1">&lt;</button>
                        <button class="btn interactable" id="btn-play" data-label="TOGGLE">PLAY</button>
                        <button class="btn interactable" id="btn-next" data-label="FRAME +1">&gt;</button>
                    </div>

                    <div style="display:flex; gap: 10px; align-items: center; justify-content: flex-end;">
                        <div id="time-display" style="font-size: 0.8rem;">00:00.00</div>
                        <button class="btn btn-main interactable" id="btn-extract" data-label="EXECUTE">EXTRACT</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- WINDOW 2: SYSTEM LOG -->
    <div class="os-window" id="win-log" style="width: 300px; height: 400px; top: 20%; left: 10%;">
        <div class="win-header" id="drag-log">
            <span class="win-title">KERNEL_EVENTS</span>
            <div class="win-controls"><div class="win-btn"></div></div>
        </div>
        <div class="win-content">
            <div class="term-lines" id="sys-log"></div>
        </div>
    </div>

    <!-- WINDOW 3: AUDIO VISUALIZER -->
    <div class="os-window" id="win-audio" style="width: 300px; height: 150px; bottom: 10%; right: 5%;">
        <div class="win-header" id="drag-audio">
            <span class="win-title">AUDIO_SYNTH</span>
        </div>
        <div class="win-content" style="padding: 0;">
            <canvas id="audio-scope" style="width: 100%; height: 100%; opacity: 0.5;"></canvas>
        </div>
    </div>


    <script>
        /* 
        ==========================================================================
        // MEXTRACT ENGINE CORE
        // 3000 LINES OF LOGIC CONDENSED INTO HIGH-DENSITY JS
        ==========================================================================
        */

        // --- MODULE: AUDIO SYNTHESIZER ---
        const AudioCore = {
            ctx: null,
            init: function() {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
                this.master = this.ctx.createGain();
                this.master.gain.value = 0.1; // Keep it quiet
                this.master.connect(this.ctx.destination);
            },
            playTone: function(freq, type, duration) {
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(freq * 0.5, this.ctx.currentTime + duration);
                
                gain.gain.setValueAtTime(0.5, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
                
                osc.connect(gain);
                gain.connect(this.master);
                osc.start();
                osc.stop(this.ctx.currentTime + duration);
            },
            uiHover: function() { this.playTone(800, 'sine', 0.05); },
            uiClick: function() { this.playTone(1200, 'square', 0.1); },
            uiError: function() { this.playTone(150, 'sawtooth', 0.3); },
            uiSuccess: function() { 
                this.playTone(2000, 'sine', 0.1); 
                setTimeout(() => this.playTone(3000, 'sine', 0.2), 100);
            }
        };

        // --- MODULE: RAIN PHYSICS ---
        class RainSystem {
            constructor() {
                this.c = document.getElementById('rain-canvas');
                this.ctx = this.c.getContext('2d');
                this.resize();
                window.addEventListener('resize', () => this.resize());
                this.drops = [];
                this.initDrops();
                this.loop();
            }
            resize() { this.c.width = window.innerWidth; this.c.height = window.innerHeight; }
            initDrops() {
                for(let i=0; i<150; i++) this.drops.push(this.newDrop());
            }
            newDrop() {
                return {
                    x: Math.random() * this.c.width,
                    y: Math.random() * this.c.height,
                    l: Math.random() * 20 + 10, // Length (Pixel art style stretch)
                    s: Math.random() * 10 + 10  // Speed
                };
            }
            loop() {
                this.ctx.clearRect(0,0,this.c.width,this.c.height);
                this.ctx.fillStyle = '#fff';
                this.drops.forEach(d => {
                    d.y += d.s;
                    if(d.y > this.c.height) { d.y = -20; d.x = Math.random() * this.c.width; }
                    this.ctx.fillRect(Math.floor(d.x), Math.floor(d.y), 1, Math.floor(d.l));
                });
                requestAnimationFrame(() => this.loop());
            }
        }

        // --- MODULE: PARTICLE LOGO MORPH ---
        class LogoEngine {
            constructor() {
                this.c = document.getElementById('logo-canvas');
                this.ctx = this.c.getContext('2d');
                this.textA = "MEXTRACT";
                this.textB = "MAXFLUXAI";
                this.particles = [];
                this.target = "A";
                this.mouseOver = false;
                
                this.c.addEventListener('mouseenter', () => { this.target = "B"; this.mouseOver = true; AudioCore.uiHover(); });
                this.c.addEventListener('mouseleave', () => { this.target = "A"; this.mouseOver = false; });
                
                this.init();
                this.animate();
            }
            
            getPoints(text) {
                const tmp = document.createElement('canvas');
                tmp.width = 400; tmp.height = 100;
                const tctx = tmp.getContext('2d');
                tctx.font = '900 40px "JetBrains Mono"';
                tctx.fillStyle = '#fff';
                tctx.textAlign = 'center';
                tctx.textBaseline = 'middle';
                tctx.fillText(text, 200, 50);
                
                const data = tctx.getImageData(0,0,400,100).data;
                const points = [];
                for(let y=0; y<100; y+=3) {
                    for(let x=0; x<400; x+=3) {
                        if(data[(y*400+x)*4+3] > 128) points.push({x,y});
                    }
                }
                return points;
            }

            init() {
                this.ptsA = this.getPoints(this.textA);
                this.ptsB = this.getPoints(this.textB);
                const max = Math.max(this.ptsA.length, this.ptsB.length);
                
                for(let i=0; i<max; i++) {
                    this.particles.push({
                        x: Math.random()*400, y: Math.random()*100,
                        vx: 0, vy: 0
                    });
                }
            }

            animate() {
                this.ctx.clearRect(0,0,400,100);
                this.ctx.fillStyle = '#fff';
                
                const targets = this.target === "A" ? this.ptsA : this.ptsB;
                
                this.particles.forEach((p, i) => {
                    let tx, ty;
                    if(targets[i]) {
                        tx = targets[i].x;
                        ty = targets[i].y;
                    } else {
                        tx = 200; ty = 50; // Center fallback
                    }
                    
                    const dx = tx - p.x;
                    const dy = ty - p.y;
                    
                    p.vx += dx * 0.03; // Spring
                    p.vy += dy * 0.03;
                    p.vx *= 0.85;      // Damp
                    p.vy *= 0.85;
                    
                    if(this.mouseOver) {
                        p.x += (Math.random()-0.5)*2; // Jitter
                        p.y += (Math.random()-0.5)*2;
                    }
                    
                    p.x += p.vx;
                    p.y += p.vy;
                    
                    if(targets[i]) this.ctx.fillRect(p.x, p.y, 2, 2);
                });
                requestAnimationFrame(() => this.animate());
            }
        }

        // --- MODULE: WINDOW MANAGER ---
        class WindowManager {
            constructor() {
                this.windows = document.querySelectorAll('.os-window');
                this.zIndex = 100;
                this.dragTarget = null;
                this.offset = {x:0, y:0};
                
                this.windows.forEach(w => {
                    w.addEventListener('mousedown', () => this.focus(w));
                    const header = w.querySelector('.win-header');
                    if(header) header.addEventListener('mousedown', (e) => this.startDrag(e, w));
                });

                document.addEventListener('mousemove', (e) => this.drag(e));
                document.addEventListener('mouseup', () => this.endDrag());
            }
            
            focus(win) {
                this.zIndex++;
                win.style.zIndex = this.zIndex;
                win.classList.add('active');
                this.windows.forEach(w => { if(w !== win) w.classList.remove('active'); });
            }

            startDrag(e, win) {
                this.dragTarget = win;
                const rect = win.getBoundingClientRect();
                this.offset.x = e.clientX - rect.left;
                this.offset.y = e.clientY - rect.top;
                // Convert transform translate to top/left for easier dragging
                win.style.transform = 'none'; 
                win.style.left = rect.left + 'px';
                win.style.top = rect.top + 'px';
                win.style.width = rect.width + 'px';
                win.style.height = rect.height + 'px';
            }

            drag(e) {
                if(!this.dragTarget) return;
                this.dragTarget.style.left = (e.clientX - this.offset.x) + 'px';
                this.dragTarget.style.top = (e.clientY - this.offset.y) + 'px';
            }

            endDrag() { this.dragTarget = null; }
        }

        // --- MODULE: APP LOGIC & VIDEO ---
        const App = {
            els: {
                boot: document.getElementById('boot-sequence'),
                bootProg: document.getElementById('boot-prog'),
                winMain: document.getElementById('win-main'),
                log: document.getElementById('sys-log'),
                upload: document.getElementById('stack-upload'),
                editor: document.getElementById('stack-editor'),
                video: document.getElementById('main-video'),
                fileIn: document.getElementById('file-input'),
                seek: document.getElementById('seek-input'),
                scrub: document.getElementById('scrub-bar'),
                time: document.getElementById('time-display')
            },
            
            log: function(msg, type) {
                const d = document.createElement('div');
                d.className = 'log-entry' + (type ? ' log-'+type : '');
                d.innerText = `> ${msg}`;
                this.els.log.prepend(d);
            },

            boot: function() {
                // Simulate BIOS
                let p = 0;
                const int = setInterval(() => {
                    p += Math.random()*10;
                    if(p > 100) p = 100;
                    this.els.bootProg.style.width = p + '%';
                    if(p === 100) {
                        clearInterval(int);
                        setTimeout(() => {
                            this.els.boot.classList.add('hidden');
                            document.querySelectorAll('.os-window').forEach(w => w.classList.add('visible'));
                            this.log("SYSTEM ONLINE", "succ");
                            AudioCore.init();
                        }, 500);
                    }
                }, 100);
            },

            init: function() {
                this.boot();
                new RainSystem();
                new LogoEngine();
                new WindowManager();

                // Upload Handlers
                this.els.upload.addEventListener('click', () => this.els.fileIn.click());
                this.els.fileIn.addEventListener('change', (e) => this.loadVideo(e.target.files[0]));
                
                // Video Handlers
                const v = this.els.video;
                document.getElementById('btn-play').addEventListener('click', () => {
                    if(v.paused) { v.play(); this.log("PLAYBACK START"); }
                    else { v.pause(); this.log("PLAYBACK HALT"); }
                    AudioCore.uiClick();
                });
                
                // Seeking
                this.els.seek.addEventListener('input', (e) => {
                    v.currentTime = e.target.value;
                    v.pause();
                    this.updateScrub();
                });
                v.addEventListener('timeupdate', () => {
                    this.els.seek.value = v.currentTime;
                    this.updateScrub();
                });

                // Frame Steps
                const F = 0.04;
                document.getElementById('btn-prev').addEventListener('click', () => { v.currentTime -= F; v.pause(); AudioCore.uiClick(); });
                document.getElementById('btn-next').addEventListener('click', () => { v.currentTime += F; v.pause(); AudioCore.uiClick(); });

                // Extract
                document.getElementById('btn-extract').addEventListener('click', () => this.extract());

                // Cursor Interaction
                document.querySelectorAll('.interactable').forEach(el => {
                    el.addEventListener('mouseenter', () => { AudioCore.uiHover(); document.body.classList.add('state-hover'); });
                    el.addEventListener('mouseleave', () => { document.body.classList.remove('state-hover'); });
                    el.addEventListener('mousedown', () => { AudioCore.uiClick(); document.body.classList.add('state-active'); });
                    el.addEventListener('mouseup', () => { document.body.classList.remove('state-active'); });
                });
                
                // Mouse tracking
                const cx = document.querySelector('.cursor-main');
                const cd = document.querySelector('.cursor-dot');
                const clx = document.querySelector('.cursor-x-line');
                const cly = document.querySelector('.cursor-y-line');
                
                document.addEventListener('mousemove', e => {
                    cx.style.left = e.clientX + 'px'; cx.style.top = e.clientY + 'px';
                    cd.style.left = e.clientX + 'px'; cd.style.top = e.clientY + 'px';
                    clx.style.top = e.clientY + 'px';
                    cly.style.left = e.clientX + 'px';
                });
            },

            loadVideo: function(file) {
                if(!file) return;
                this.log("MOUNTING DRIVE...", "warn");
                const url = URL.createObjectURL(file);
                this.els.video.src = url;
                this.els.video.onloadedmetadata = () => {
                    this.els.upload.classList.add('hidden');
                    this.els.editor.classList.remove('hidden');
                    this.els.seek.max = this.els.video.duration;
                    this.log("VIDEO STREAM ACTIVE", "succ");
                    this.log(`RES: ${this.els.video.videoWidth}x${this.els.video.videoHeight}`);
                    AudioCore.uiSuccess();
                };
            },

            updateScrub: function() {
                const pct = (this.els.video.currentTime / this.els.video.duration) * 100;
                this.els.scrub.style.width = pct + "%";
                this.els.time.innerText = this.els.video.currentTime.toFixed(2);
            },

            extract: function() {
                if(this.els.video.readyState < 2) return;
                this.log("INITIATING FRAME CAPTURE...", "warn");
                
                const cvs = document.createElement('canvas');
                cvs.width = this.els.video.videoWidth;
                cvs.height = this.els.video.videoHeight;
                const ctx = cvs.getContext('2d');
                ctx.drawImage(this.els.video, 0, 0, cvs.width, cvs.height);
                
                try {
                    const data = cvs.toDataURL('image/png');
                    const a = document.createElement('a');
                    a.href = data;
                    a.download = `FRAME_${Date.now()}.png`;
                    a.click();
                    this.log("FRAME SAVED TO DISK", "succ");
                    AudioCore.uiSuccess();
                } catch(e) {
                    this.log("ERR: SECURITY BLOCK (CORS)", "warn");
                    AudioCore.uiError();
                }
            }
        };

        // --- MODULE: AUDIO VISUALIZER (SIMULATED) ---
        (function() {
            const c = document.getElementById('audio-scope');
            const ctx = c.getContext('2d');
            let data = new Array(50).fill(0);
            
            function loop() {
                data.shift();
                data.push(Math.random());
                
                c.width = c.offsetWidth; c.height = c.offsetHeight;
                ctx.clearRect(0,0,c.width,c.height);
                ctx.strokeStyle = '#ffffff';
                ctx.beginPath();
                
                const step = c.width / 50;
                data.forEach((v, i) => {
                    const h = v * c.height;
                    if(i==0) ctx.moveTo(i*step, (c.height-h)/2);
                    else ctx.lineTo(i*step, (c.height-h)/2 + (Math.random()*h));
                });
                ctx.stroke();
                requestAnimationFrame(loop);
            }
            loop();
        })();

        // START SYSTEM
        window.addEventListener('load', () => App.init());

    </script>
</body>
</html>